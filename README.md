<h1 align=center> Board Games Rulebook

![](https://img.shields.io/badge/Python-3.9-blue) ![](https://img.shields.io/badge/faiss-1.8.0-blue) ![](https://img.shields.io/badge/langchain-0.2.5-blue) ![](https://img.shields.io/badge/PyMuPDF-1.24.5-blue) ![](https://img.shields.io/badge/LICENSE-MIT-red)</h1>

<p align = left>A simple application that uses a faiss vector database to store data embeddings from pdf rulebooks for popular board games and retrieves top-5 closest embeddings to a user query. The retrieved queries are combined into a single context and sent to Llama 3 along with the original user query to generate a coherent response to the query based on the context.</p>

<p align="center">
  <img src = assets/rag-intuition.png max-width = 100% height = '400' />
</p>

## Project Structure

```html
|- library
  |-- MONOPOLY.pdf
  |-- UNO.pdf
|- notebook
  |-- trials.ipynb
|- database.py
|- embeddings.py
|- main.py
```

## How to get started?

Open terminal and run the following commands one by one

```html
mkdir Project
```
Now switch to the newly created Project directory using

```html
cd Project
```
Now clone the github repository inside your working directory using

```html
git clone https://github.com/kotiyalanurag/Board-Games-Rulebook.git
```
Create a python virtual environment using

```html
python -m venv env
```

Activate the environment using

```html
source env/bin/activate
```

Now, load all the dependencies for the project using 

```html
pip install -r requirements.txt
```
## How to install Ollama?

Ollama helps us to run LLMs locally. Apart from the package dependencies you need to have Ollama installed on your system using this [link](https://github.com/ollama/ollama).

Once, you're done with the installations run the following on your terminal. Replace model with model of your choice like llama2, llama3, minstral etc.

```html
ollama run model
```

Running this for the first time will take a couple of minutes since it downloads the model on your local system. If you already have the model then you can start an Ollama server using

```html
ollama serve
```

Now we're ready to start our application.

## Hyperparameters

For the faiss vector database, chunk size and chunk overlap make a significant difference when retrieving relevant documents based on a query.

```python
# tried with 250, 500, and 750 
chunk_size = 250

# usually set it to 10% of chunk size
chunk_overlap = 25
```

The embedding models play an important role as generated vector quality completely depends upon the embedding model used.

```python
# for english language embeddings in 384 dimensions
model_name = "sentence-transformers/all-MiniLM-l6-v2"
```

## How to run the application from CLI?

Open your terminal and type the following, where you replace "insert-your-query-here" with your query in English.

```python
python main.py -q "insert-your-query-here"
```
## Context + Query Template for Llama3

Here is what the combined query plus context template fed to Llama3 looks like. Note that the context is retrieved from the vector database based on a similarity search with the query.

```html
Human: 
Answer the question based only on the following context:

text.
Q: How many cards are in an Uno deck?
A: 112 (108 + 4 blank cards is the standard); however, some versions have more cards.
Q: How many cards do you start with?
A: 7 cards each. 
Q: How do you win at Uno? the other cards, see directions that follow.7OFFICIAL UNO RULES
Classic Uno
CONTENTS
112 cards as follows:
76 Numbered cards 8 Skip cards
8 Reverse cards 8 Draw 2 cards
2 Blue Draw 2 Cards
2 Green Draw 2 Cards
2 Red Draw 2 Cards 2 Red Draw 2 Cards
2 Yellow Draw 2 Cards2 Yellow Skip cards
2 Red Skip cards
2 Green Skip cards
2 Blue Skip cards
Some Uno decks can also contain various numbers of these different

---

Answer the question based on the above context: How many cards in an UNO deck?
```

## Question-Answering using RAG

Below you can see some example queries that were sent to the model and the response that was generated by the model based on RAG using our faiss database. In addition to a response the application also cites the sources from the pdf using unique chunk 'id' that it used for answering the query. To see the complete results check out trials inside notebook directory.

1. Query -> "How many cards in an UNO deck?"

```html
Response: According to the provided text, there are 112 cards in a standard Uno deck.
```
2. Query -> "How do you win in UNO?"

```html
Response: According to the provided context, the first player to score 500 points wins the game. Additionally, if a player has no cards left at the end of each hand, they also win that round. However, the ultimate winner is determined by the player with the lowest points among all players who have reached 500 points or more.
```

3. Query -> "How to play UNO?"

```html
Response: According to the provided context, here's how to play UNO:

    1. If you draw a card you can play, play it.
    2. Otherwise, play moves to the next person.

    Before playing your next-to-last card, you must say "UNO".

    That's it! Simple rules, indeed.
```

4. Query -> "How many players can play Monopoly?"

```html
Response: According to the context, 2 to 8 players can play Monopoly.
```

5. Query -> "What are the speed die rules in Monopoly?"

```html
Response: According to the given context, the Speed Die rules in Monopoly are as follows:

    1. Roll the Speed Die along with the two white dice on your turn.
    2. Depending on what you rolled, do the following:
        * If you roll a combination that allows you to use the Speed Die (not specified what this is), 
        you can start using it before others.

    Note: The rest of the rules are described as "additional" and assume you already know how to play 
    Monopoly according to the classic rules.
```

6. Query -> "What is the Banker in Monopoly?"

```html
Response: According to the provided context, the Banker is a player who will also make a good Auctioneer. The Banker's main role is to keep their personal funds and issue as much more as needed by writing on any ordinary paper.
```
